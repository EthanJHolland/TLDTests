<!DOCTYPE HTML>

<html>
<head>
    
    <!--The CSS file is named visualizationstyles2.css-->
    <link rel="stylesheet" href="view.css">
    
    <!--these are links to Google Font CDNs-->
    <link href="https://fonts.googleapis.com/css?family=Crimson+Text" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Cormorant+Garamond" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Seaweed+Script" rel="stylesheet">
    
</head>
    
<body>
    
<!--    <img class="logo logoIMAGE" src='logo.JPG'>-->
    <p class="logo menu">Letterdesk</p>
    <p class="logoTEXT about menu">WHAT IS THIS?</p>
    
    <p class="logoTEXT pause details"><span style="color: #ffc8c8;">SPACEBAR</span></p>
    <p class="logoTEXT fastfor details"><span style="color: #ffc8c8;">RIGHT ARROW</span></p>
    
    <!--the location and time appear only when you click the letter-->
    <p class="logoTEXT location details">  </p>
    <p class="logoTEXT time details"></p>
    
    <!--open letter button: to move this around relative to the page, move wrapper div-->
    <div class="wrapper">
        <div class="start"><span style="font-size: 1.1em;">O</span>PEN <span style="font-size: 1.1em;">L</span>ETTER</div>
    </div>
    
    <!--the letter itself (after you open the letter)-->
    <div class="letter">
        <div class=letterHEADER></div>
        <div class="words">
        </div>
    </div>
    
    <!--some details you can only see AFTER the letter-->
    <p class="logoTEXT postLetterWrite">WRITE A LETTER</p>
    
    <!--jquery-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    
    <script>
        
        //feed in data!
        var order = [84,72,73,83,32,73,83,32,16,86000,69000,82000,89000,32000,67,79,79,76,190,32,16,73000,32,87,79,78,68,69,82,32,72,79,87,32,77,8,76,79,78,71,32,84,72,73,83,32,87,73,76,76,32,87,79,82,75,32,16,49000,50000,51000,52000,53000,54000,55000,32,70,79,82,190];
        var absTimes = [0,0.083714,0.131865,0.23389,0.324595,0.39293,0.589445,0.705414,0.85823,1.030895,1.181719,1.274345,1.394964,1.527914,1.885035,1.96724,2.093445,2.18488,2.3948,2.629249,2.834939,2.890834,2.952389,3.144405,3.190925,3.248,3.308519,3.45834,3.497105,3.64923,3.780535,3.822815,3.920704,4.045725,4.410254,4.864694,5.041549,5.169144,5.218615,5.284729,5.381694,5.49291,5.564629,5.60192,5.692925,5.757865,5.913669,5.973215,6.03025,6.179484,6.259885,6.44852,6.514835,6.607955,6.664385,7.597869,7.867384,8.131795,8.389454,8.45655,8.508064,8.564735,8.61553,8.68674,9.187769,9.60483,9.66509,9.753895,9.938065];
        var locationString = "gothic reading room";
        
        //global variables
        var pause = false;
        var totalString = ""; //what is outputted
        var i=0; //what array index we are on
        var output = document.getElementsByClassName("words")[0]; //what div the letter is typed into
        var shift = false; //if the shift key was pressed down 1 keypress ago
        var CAPSLOCK = false;
        
        //kind of like a main method that executes everything
        $(document).ready(function(){
            $(".about").click(function(){
                //clicking WHAT IS THIS takes them to home page
                window.open("home.html"); 
            });
            $(".logo").click(function(){
                //clicking logo takes them to home page
                window.open("home.html"); 
            });
            $(".postLetterWrite").click(function(){
                //clicking WRITE A LETTER takes them to writing page
                window.open("writing.html"); 
            });
            $(".start").click(function(){
                //when you click .start (the open letter button), all this happens:
                document.getElementsByClassName("location")[0].innerHTML = locationString.toUpperCase();
                $(".wrapper").fadeOut(400); //fade out the start button (using a wrapper div)
                $("body").toggleClass("typing"); //change the body background
                $(".menu").toggleClass("typing"); //fade out the logo
                $(".details").toggleClass("typing"); //fade in the details (i.e. the clock)
                $(".letter").toggleClass("typing"); //allow the letter to be visible
                
                //start typing
                type();
                
                //startClock(); //don't use for now because testing revealed people don't care
                
                //pause, fast forward, rewind
                document.body.onkeydown = function(e) {
                    if (e.which===32) {
                        //spacebar
                        if (pause===false) {
                            //if currently playing, then pause
                            pause = true;
                        }
                        else {
                            //if currently paused, then play
                            pause = false;
                            
                            //keep typin'
                            type();
                        }
                    }
                    if (e.which===39) {
                        //right arrow key
                        pause = true;
                        
                        //update for any spaces
                        while (order[i]===32 && i<order.length) {
                            updateString(i);
                            i++;
                        }
                        while (order[i] !==32 && i<order.length) {
                            updateString(i);
                            i++;
                        }
                    }
                };
            });
        });
        
        //this function takes into account the appropriate delay
        //before calling updateString() to update the output
        function type() {
            var k=1;
            if (i===0) {
                //wait 500ms before the letter begins, to allow transitions to take effect
                //the user must also see the spacebar and right arrow key markers appear
                var delay = 3000;
            }
            else {
                var delay = (absTimes[i]-absTimes[i-1])*1000;
                if (delay > 2000) {delay = 2000;} //the reader doesn't want to wait forever
            }
            
            //listen for a spacebar; stop typing if paused
            if (pause===true) {
                return;
            }
            
            //use setTimeout
            setTimeout(function () {
               updateString(i);
               i++;
               if (i < order.length) {
                   type();
               }
            }, delay);
        };
        
        //each time this is called, one letter is added to the output (or backspaced)
        function updateString(index) {
            //progress (time) bar
            document.getElementsByClassName("time")[0].innerHTML = i+1 + " / " + order.length;
            
            //c is a keycode
            var c = order[index];
            
            //special characters (anything that is not a letter)
            //stored in a dictionary that maps a keycode to the resulting character
            var keyCodes ={32:" ", 13:"<br>"}
            var keyCodesSpecial ={49:"1", 50:"2", 51:"3", 52:"4", 53:"5", 54:"6", 55:"7", 56:"8", 57:"9", 48:"0", 189:"-", 187:"=", 219:"[", 221:"]", 220: "\\", 186:";", 222:"'", 188:",", 190:".", 191:"/", 192:"`"};
            var keyCodesSpecialShift = {49:"!", 50:"@", 51:"#", 52:"$", 53:"%", 54:"^", 55:"&", 56:"*", 57:"(", 48:")", 189:"_", 187:"+", 219:"{", 221:"}", 220:"|", 186:":", 222:'"', 188:"<", 190:">", 191:"?", 192:"~"};
            
            //check if SHIFT is being held
            if (c>1000) {
                shift = true;
                c = c/1000;
            } else {
                shift = false;
            }
            
            //letters have keycodes from [65,90]
            if (c>=65 && c<=90) {
                if (shift===true || CAPSLOCK===true) {
                    shift = false;
                    totalString += String.fromCharCode(c); //uppercase
                }
                else {
                    totalString += String.fromCharCode(c).toLowerCase(); //lowercase
                }
            }
            else if (c in keyCodes) {
                //special character (e.g. punctuation)
                totalString += keyCodes[c];
            }
            else if (c in keyCodesSpecial) {
                //special character (e.g. punctuation)
                if (shift==true) {
                    shift = false;
                    totalString += keyCodesSpecialShift[c];
                } else {
                    totalString += keyCodesSpecial[c];
                }
            }
            else if (c===8) {
                //backspace has keycode 8
                totalString = totalString.slice(0,-1);
            }
            else if (c===20) {
                //toggle capslock
                CAPSLOCK = !CAPSLOCK;
            }
            else {
                //for debugging only -- output the keycode if it's a character not accounted for
                //totalString += c;
            }
            
            if (index<order.length-1) {
                //everytime you update the output with updateString(),
                //totalString changes to the updated string + the cursor.
                output.innerHTML = totalString + "|";
            } 
            else {
                //if we're at the end of the letter, don't output the cursor, just output totalString.
                output.innerHTML = totalString;
                //wait 1 second before transitioning out
                setTimeout(toEnd,1000);
                
            }
            window.scrollTo(0,50000); //automatic scrolling down for long letters
        };
        
        function toEnd() {
            //toggle everything back to the original (gray) display
            $("body").toggleClass("typing");
            $(".logo").toggleClass("typing");
            $(".details").toggleClass("typing");
            $(".letter").toggleClass("typing");
            
            //add new some new details
            $(".postLetterWrite").toggleClass("final"); //show WRITE LETTER option (they want to reply!)
            document.getElementsByClassName(".postLetterLocation")[0].innerHTML = locationString;
            $(".postLetterLocation").toggleClass("final"); //still show the location
        }
        
        //clock
        //note: this is actually a FAKE clock. It updates the seconds place after waiting 1 second, 
        //instead of getting the real time from the browser
        var Digital=new Date("Sun, 22 Nov 2017 15:08:03"); //insert the start time
        function startClock(){
            Digital.setSeconds(Digital.getSeconds() + 1);
            var hours = Digital.getHours();
            var minutes = Digital.getMinutes();
            var seconds = Digital.getSeconds();
            
            var dn="am" ;
            if (hours>12){
                dn="pm";
                hours = hours-12;
            }
            if (hours === 0) {
                hours = 12;
            }
            if (minutes <= 9) {
                minutes = "0" + minutes;
            }
            if (seconds<=9) {
                seconds="0"+seconds;
            }
            
            document.getElementsByClassName("time")[0].innerHTML = hours+":"+minutes+":"+seconds+" "+dn;
            
            //re-output the clock after waiting 1 second
            setTimeout("startClock()",1000);
        }
        
    </script>
    
</body>
</html>
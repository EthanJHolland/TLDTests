<!DOCTYPE HTML>

<html>
<head>
    
    <!--The CSS file is named visualizationstyles2.css-->
    <link rel="stylesheet" href="readingStyles.css">
    
    <!--these are links to Google Font CDNs-->
    <link href="https://fonts.googleapis.com/css?family=Crimson+Text" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Cormorant+Garamond" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Seaweed+Script" rel="stylesheet">
    
</head>
    
<body>
    
<!--    <img class="logo logoIMAGE" src='logo.JPG'>-->
    <p class="logo menu">Letterdesk</p>
    <p class="logoTEXT about menu">WHAT IS THIS?</p>
    
    <p class="logoTEXT pause details"><span style="color: #ffc8c8;">SPACEBAR</span></p>
    <p class="logoTEXT fastfor details"><span style="color: #ffc8c8;">RIGHT ARROW</span></p>
    
    <!--the location and time appear only when you click the letter-->
    <p class="logoTEXT location details">  </p>
    <p class="logoTEXT time details"></p>
    
    <!--open letter button: to move this around relative to the page, move wrapper div-->
    <div class="wrapper">
        <div class="start"><span style="font-size: 1.1em;">O</span>PEN <span style="font-size: 1.1em;">L</span>ETTER</div>
    </div>
    
    <!--the letter itself (after you open the letter)-->
    <div class="letter">
        <div class=letterHEADER></div>
        <div class="words">
        </div>
    </div>
    
    <!--some details you can only see AFTER the letter-->
    <p class="logoTEXT postLetterWrite">WRITE A LETTER</p>
    
    <!--jquery-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    
    <script>
        
        //feed in data!
        var order = [16,83,73,78,67,69,32,84,72,69,32,78,79,84,69,32,73,83,32,73,78,32,77,89,32,78,79,84,69,66,79,79,75,188,32,73,84,32,80,82,69,83,85,77,65,66,66,8,76,89,32,72,65,83,32,83,79,77,69,32,77,69,65,78,73,78,71,32,84,79,32,77,69,190,32,16,73,32,83,84,85,68,89,32,73,84,32,70,79,82,32,65,32,76,79,78,71,32,87,72,69,73,76,8,8,8,73,76,69,190];
        var absTimes = [0,0.082265,0.159135,0.232569,0.27749,0.365655,0.38208,0.509105,0.535275,0.5996,0.65045,0.72723,0.79514,0.84679,0.91475,0.947315,1.013015,1.079255,1.167655,1.28932,1.36046,1.42292,1.5205,1.693625,1.74269,1.957145,2.0245,2.113195,2.18488,2.25123,2.27543,2.408005,2.48109,2.640085,2.721365,2.79957,2.874575,2.968975,3.609835,3.679565,3.74832,3.77633,3.86989,4.034214,4.18954,4.223965,4.364425,4.75758,5.2492,5.38899,5.50237,5.564805,5.65714,5.70789,5.7766,5.90076,5.929035,5.97265,6.0584,6.12976,6.197309,6.54608,6.61145,6.645945,6.70153,6.77192,6.846309,6.958995,7.08103,7.12214,7.195095,7.277495,7.329375,7.407125,7.502715,7.9243,8.04959,8.18247,8.26986,8.34411,8.41372,8.547535,8.572505,8.71095,8.824915,8.974415,9.012375,9.22282,9.240795,9.35502,9.368855,9.493675,9.533095,9.596125,9.749505,9.77449,9.864605,10.21014,10.332335,10.357245,10.40338,10.41497,10.476915,10.760945,10.92612,11.10169,11.61688,11.692115,11.779345,11.887975];
        var locationString = "gothic reading room";
        
        //global variables
        var pause = false;
        var totalString = ""; //what is outputted
        var i=0; //what array index we are on
        var output = document.getElementsByClassName("words")[0]; //what div the letter is typed into
        var shift = false; //if the shift key was pressed down 1 keypress ago
        
        //kind of like a main method that executes everything
        $(document).ready(function(){
            $(".about").click(function(){
                //clicking WHAT IS THIS takes them to home page
                window.open("home.html"); 
            });
            $(".logo").click(function(){
                //clicking logo takes them to home page
                window.open("home.html"); 
            });
            $(".postLetterWrite").click(function(){
                //clicking WRITE A LETTER takes them to writing page
                window.open("writing.html"); 
            });
            $(".start").click(function(){
                //when you click .start (the open letter button), all this happens:
                document.getElementsByClassName("location")[0].innerHTML = locationString.toUpperCase();
                $(".wrapper").fadeOut(400); //fade out the start button (using a wrapper div)
                $("body").toggleClass("typing"); //change the body background
                $(".menu").toggleClass("typing"); //fade out the logo
                $(".details").toggleClass("typing"); //fade in the details (i.e. the clock)
                $(".letter").toggleClass("typing"); //allow the letter to be visible
                
                //start typing
                type();
                
                //startClock(); //don't use for now because testing revealed people don't care
                
                //pause, fast forward, rewind
                document.body.onkeydown = function(e) {
                    if (e.which===32) {
                        //spacebar
                        if (pause===false) {
                            //if currently playing, then pause
                            pause = true;
                        }
                        else {
                            //if currently paused, then play
                            pause = false;
                            
                            //keep typin'
                            type();
                        }
                    }
                    if (e.which===39) {
                        //right arrow key
                        pause = true;
                        
                        //update for any spaces
                        while (order[i]===32 && i<order.length) {
                            updateString(i);
                            i++;
                        }
                        while (order[i] !==32 && i<order.length) {
                            updateString(i);
                            i++;
                        }
                    }
                };
            });
        });
        
        //this function takes into account the appropriate delay
        //before calling updateString() to update the output
        function type() {
            var k=1;
            if (i===0) {
                //wait 500ms before the letter begins, to allow transitions to take effect
                //the user must also see the spacebar and right arrow key markers appear
                var delay = 3000;
            }
            else {
                var delay = (absTimes[i]-absTimes[i-1])*1000;
                if (delay > 2000) {delay = 2000;} //the reader doesn't want to wait forever
            }
            
            //listen for a spacebar; stop typing if paused
            if (pause===true) {
                return;
            }
            
            //use setTimeout
            setTimeout(function () {
               updateString(i);
               i++;
               if (i < order.length) {
                   type();
               }
            }, delay);
        };
        
        //each time this is called, one letter is added to the output (or backspaced)
        function updateString(index) {
            //progress (time) bar
            document.getElementsByClassName("time")[0].innerHTML = i+1 + " / " + order.length;
            
            //c is a keycode
            var c = order[index];
            
            //special characters (anything that is not a letter)
            //stored in a dictionary that maps a keycode to the resulting character
            var keyCodes ={32:" ", 188:",", 190:".", 49:"!", 191:"?",13:"<br>", 57:"(", 48:")", 222:"'", 189:"-", 186:":"};
            
            //letters have keycodes from [65,90]
            if (c>=65 && c<=90) {
                if (shift===true) {
                    shift = false;
                    totalString += String.fromCharCode(c); //uppercase
                }
                else {
                    totalString += String.fromCharCode(c).toLowerCase(); //lowercase
                }
            }
            else if (c in keyCodes) {
                //special character (e.g. punctuation)
                totalString += keyCodes[c];
            }
            else if (c===8) {
                //backspace has keycode 8
                totalString = totalString.slice(0,-1);
            }
            else if (c===16) {
                //shift has keycode 16
                shift = true;
            }
            else {
                //for debugging only -- output the keycode if it's a character not accounted for
                //totalString += c;
            }
            
            if (index<order.length-1) {
                //everytime you update the output with updateString(),
                //totalString changes to the updated string + the cursor.
                output.innerHTML = totalString + "|";
            } 
            else {
                //if we're at the end of the letter, don't output the cursor, just output totalString.
                output.innerHTML = totalString;
                //wait 1 second before transitioning out
                setTimeout(toEnd,1000);
                
            }
            window.scrollTo(0,50000); //automatic scrolling down for long letters
        };
        
        function toEnd() {
            //toggle everything back to the original (gray) display
            $("body").toggleClass("typing");
            $(".logo").toggleClass("typing");
            $(".details").toggleClass("typing");
            $(".letter").toggleClass("typing");
            
            //add new some new details
            $(".postLetterWrite").toggleClass("final"); //show WRITE LETTER option (they want to reply!)
            document.getElementsByClassName(".postLetterLocation")[0].innerHTML = locationString;
            $(".postLetterLocation").toggleClass("final"); //still show the location
        }
        
        //clock
        //note: this is actually a FAKE clock. It updates the seconds place after waiting 1 second, 
        //instead of getting the real time from the browser
        var Digital=new Date("Sun, 22 Nov 2017 15:08:03"); //insert the start time
        function startClock(){
            Digital.setSeconds(Digital.getSeconds() + 1);
            var hours = Digital.getHours();
            var minutes = Digital.getMinutes();
            var seconds = Digital.getSeconds();
            
            var dn="am" ;
            if (hours>12){
                dn="pm";
                hours = hours-12;
            }
            if (hours === 0) {
                hours = 12;
            }
            if (minutes <= 9) {
                minutes = "0" + minutes;
            }
            if (seconds<=9) {
                seconds="0"+seconds;
            }
            
            document.getElementsByClassName("time")[0].innerHTML = hours+":"+minutes+":"+seconds+" "+dn;
            
            //re-output the clock after waiting 1 second
            setTimeout("startClock()",1000);
        }
        
    </script>
    
</body>
</html>
<!DOCTYPE HTML>

<html>
<head>
    <link href="https://fonts.googleapis.com/css?family=Sacramento" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto+Slab:300" rel="stylesheet">
</head>    
    
<body style="width: 50%; margin: 0 auto;">
    
    <p id="demo" style="font-weight: 900;">
        Write a letter as you wish :)<br><br>After you finish, press this button, then copy and send everything to <em>knchu97@gmail.com</em> <button onclick="showOrder()">Click to Finish</button></p>
    
    <textarea id="myInput" rows=30 cols=80 autofocus></textarea>
    <div id="stats" style="word-wrap: break-word;"></div>
    
    <script>
        
        var output = document.getElementById("output");
        var stats = document.getElementById("stats");
        
        //parallel arrays
        var order = []; //order of down presses
        var down = []; //down times
        var duration = []; //press duration times
        var times = []; //absolute continuous times starting from 0
        var i = 0; //currently on the ith element of all these parallel arrays
        
        document.body.onkeydown = function(e) {
            order[i] = e.which;
            down[i] = e.timeStamp;
            times[i] = Math.floor((e.timeStamp - down[0]) * 1000) / 1000000;
            
            //press durations must be kept in the same order as other arrays to ensure it is parallel
            //use -1 as a placeholder for now to keep parallel
            //press durations will be updated when the key is released (onkeyup)
            duration[i] = -1;
            
            i++;
        };

        document.body.onkeyup = function(e) {
            //find most recent (and only) occurence of e.which in duration for which the value is -1;
            
            for (var recent = i-1; recent>=0; recent--) {
                if ((duration[recent] === -1) && (order[recent]===e.which)) {                    
                    //recent is now set in terms of i
                    duration[recent] = Math.floor((e.timeStamp - down[recent]) * 1000) / 1000000;
                }
            }
        };
        
        
        //show stats
        function showOrder() {
            var element = document.getElementById("myInput");
            element.parentNode.removeChild(element);
            stats.innerHTML += "_____________________________________________________________________ <br><br>"
            stats.innerHTML += "order:" + "<br>" + order + "<br><br>";
            stats.innerHTML += "absTimes:" + "<br>" + times + "<br><br>";
            stats.innerHTML += "pressDuration:" + "<br>" + duration + "<br><br>";
        };
        
    </script>

</body>
</html>
